<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
            xmlns:xamify="clr-namespace:Xamify.UberWebViewLib;assembly=Xamify.UberWebViewLib"
             xmlns:cons="clr-namespace:TownFish.App;assembly=TownFish.App"
            Title="TownFish"
             x:Class="TownFish.App.Pages.BrowserPage">
  <ContentPage.Resources>
    <ResourceDictionary>
      <cons:SearchFormatConverter x:Key="searchCon"></cons:SearchFormatConverter>
      <Style x:Key="BottomNavBtnStyle" TargetType="Button">
        <Setter Property="TextColor" Value="#8b8b8b" />
        <Setter Property="BackgroundColor" Value="White" />
        <Setter Property="FontSize" Value="10" />
        <Setter Property="HorizontalOptions" Value="Fill" />
      </Style>
      <Style x:Key="TopNavBtnStyle" TargetType="Button">
        <Setter Property="TextColor" Value="#686868" />
        <Setter Property="BackgroundColor" Value="#e8e8e8" />
        <Setter Property="FontSize" Value="14" />
      </Style>
    </ResourceDictionary>
  </ContentPage.Resources>
  <Grid RowSpacing="0">
    <Grid.RowDefinitions>
      <RowDefinition Height="auto" />
      <RowDefinition Height="auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="auto"/>
    </Grid.RowDefinitions>

    <!-- Top Menu Bar -->
    <Grid x:Name="topBar" IsVisible="{Binding IsTopBarVisible}" BackgroundColor="#787878" Padding="10,10,10,10">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="auto" />
        <ColumnDefinition />
        <ColumnDefinition Width="auto"/>
        <ColumnDefinition Width="10" />
        <ColumnDefinition Width="auto"/>
      </Grid.ColumnDefinitions>
      <Image Source="{Binding TopBarLeftLabel}" Grid.Column="0" HorizontalOptions="Center" WidthRequest="20" HeightRequest="20">
        <Image.GestureRecognizers>
          <TapGestureRecognizer Command="{Binding TopBarLeftCommand}"/>
        </Image.GestureRecognizers>
      </Image>
      <Label VerticalOptions="Center" HorizontalOptions="Center" Grid.Column="1" Text="{Binding PageTitle}" />
      <Image Source="{Binding TopBarRightLabel}" Grid.Column="2" HorizontalOptions="Center" WidthRequest="20" HeightRequest="20">
        <Image.GestureRecognizers>
          <TapGestureRecognizer Command="{Binding TopBarRightCommand}"/>
        </Image.GestureRecognizers>
      </Image>
      <Image Source="{Binding TopBarRight1Label}" Grid.Column="4" HorizontalOptions="Center" WidthRequest="20" HeightRequest="20">
        <Image.GestureRecognizers>
          <TapGestureRecognizer Command="{Binding TopBarRight1Command}"/>
        </Image.GestureRecognizers>
      </Image>
    </Grid>

    <!-- Top bar Sub -->
    <Grid Grid.Row="1" BackgroundColor="#e8e8e8" ColumnSpacing="10" Padding="10, 0" IsVisible="{Binding IsTopBarSubVisible}">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="auto" />
        <ColumnDefinition Width="auto" />
        <ColumnDefinition Width="auto" />
        <ColumnDefinition Width="auto" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="auto" />
      </Grid.ColumnDefinitions>
      <Button Text="{Binding TopAction1Label}"
              Command="{Binding TopAction1Command}"
              Style="{StaticResource TopNavBtnStyle}" />
      <Button Grid.Column="1"
              Text="{Binding TopAction2Label}"
              Command="{Binding TopAction2Command}"
              Style="{StaticResource TopNavBtnStyle}" />
      <Button Grid.Column="2"
              Text="{Binding TopAction3Label}"
              Command="{Binding TopAction3Command}"
              Style="{StaticResource TopNavBtnStyle}" />
      <Image Source="{Binding TopActionMoreLabel}" Grid.Column="5" HorizontalOptions="Center" WidthRequest="20" HeightRequest="20">
        <Image.GestureRecognizers>
          <TapGestureRecognizer Command="{Binding TopActionMoreCommand}"/>
        </Image.GestureRecognizers>
      </Image>
    </Grid>

    <!-- Top form -->
    <Grid RowSpacing="0" Grid.Row="1" IsVisible="{Binding IsTopFormBarVisible}" BackgroundColor="#F2F2F2">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="auto" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="auto" />
      </Grid.ColumnDefinitions>
      <Button Command="{Binding TopFormLeftAction}"
              Grid.Column="0"
              Text="{Binding TopFormLeftActionLabel}"
              BackgroundColor="#F2F2F2"
              TextColor="#007aff">
      </Button>
      <Button Command="{Binding TopFormRightAction}"
              Grid.Column="2"
              Text="{Binding TopFormRightActionLabel}"
              BackgroundColor="#F2F2F2"
              TextColor="#007aff">
      </Button>
    </Grid>

    <!-- WebView -->
    <xamify:UberWebView x:Name="webView" Grid.Row="2" Source="{Binding Source}"  VerticalOptions="Fill" HorizontalOptions="Fill" />

    <!-- Bottom Menu Bar -->
    <Grid Grid.Row="3" BackgroundColor="#F2F2F2" Padding="10" IsVisible="{Binding IsBottomBarVisible}">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>
      <Image Source="{Binding BottomAction1Label}" HorizontalOptions="Center" WidthRequest="30" HeightRequest="30">
        <Image.GestureRecognizers>
          <TapGestureRecognizer Command="{Binding BottomAction1Command}"/>
        </Image.GestureRecognizers>
      </Image>
      <Image Source="{Binding BottomAction2Label}" Grid.Column="1" HorizontalOptions="Center" WidthRequest="30" HeightRequest="30">
        <Image.GestureRecognizers>
          <TapGestureRecognizer Command="{Binding BottomAction2Command}"/>
        </Image.GestureRecognizers>
      </Image>
      <Image Source="{Binding BottomAction3Label}" Grid.Column="2" HorizontalOptions="Center" WidthRequest="30" HeightRequest="30">
        <Image.GestureRecognizers>
          <TapGestureRecognizer Command="{Binding BottomAction3Command}"/>
        </Image.GestureRecognizers>
      </Image>
      <Image Source="{Binding BottomAction4Label}" Grid.Column="3" HorizontalOptions="Center" WidthRequest="30" HeightRequest="30">
        <Image.GestureRecognizers>
          <TapGestureRecognizer Command="{Binding BottomAction4Command}"/>
        </Image.GestureRecognizers>
      </Image>
      <Image Grid.Column="4" Source="{Binding BottomAction5Label}" HorizontalOptions="Center" WidthRequest="30" HeightRequest="30">
        <Image.GestureRecognizers>
          <TapGestureRecognizer Command="{Binding BottomAction5Command}"/>
        </Image.GestureRecognizers>
      </Image>
    </Grid>
    <!-- Loading Panel -->
    <Grid x:Name="loadingPanel" IsVisible="{Binding IsLoading}" Opacity="0.7" Grid.Row="2" BackgroundColor="Black">
      <ActivityIndicator VerticalOptions="Center" HorizontalOptions="Center" IsRunning="{Binding IsLoading}" />
    </Grid>
    <!-- Locations Panel-->
    <Grid x:Name="LocationPanel"
          IsVisible="{Binding SearchPanelVisible}"
          Grid.RowSpacing="0"
          Grid.ColumnSpacing="0"
          BackgroundColor="#444444"
          Grid.RowSpan="3"
          Grid.Row="1">
      <Grid.RowDefinitions>
        <RowDefinition Height="auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>
      <Button Text="My Locations" BackgroundColor="#000000" BorderRadius="0" TextColor="#ffffff" Grid.Row="0" Grid.Column="0" />
      <Button Text="Nearby Locations" Grid.Row="0" Grid.Column="1" BorderRadius="0" BackgroundColor="#ffffff" TextColor="#000000" />
      <ListView Grid.Row="1" Grid.ColumnSpan="2">
      </ListView>
    </Grid>

    <!-- Location Search Results Panel -->
    <!-- Search PANEL -->
    <Grid x:Name="TopSearchPanel"
          BackgroundColor="#444444"
          Grid.Row="0"
          WidthRequest="400" HorizontalOptions="Start"
          IsVisible="{Binding SearchPanelVisible}" Padding="20, 10">
      <Frame BackgroundColor="#333333" Padding="10,2">
        <Grid ColumnSpacing="5">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="auto"/>
          </Grid.ColumnDefinitions>
          <Image Source="{Binding TopBarRightLabel}"
                 HeightRequest="20" VerticalOptions="Center" Grid.Column="0" />
          <Entry x:Name="SearchPanelInput"
                 Grid.Column="1"
                 VerticalOptions="Start" FontSize="12"
                 HeightRequest="40"
                 HorizontalOptions="Fill"
                 BackgroundColor="#333333"
                 TextColor="#b9b9b9" />
          <Image Source="close.png"
                 HeightRequest="25" VerticalOptions="Center" Grid.Column="2" >
            <Image.GestureRecognizers>
              <TapGestureRecognizer Command="{Binding CancelSearchCommand}"/>
            </Image.GestureRecognizers>
          </Image>

        </Grid>
      </Frame>
    </Grid>

    <Grid x:Name="LocationResultsPanel"
          IsVisible="{Binding SearchLocationHasResults}"
          Grid.RowSpacing="0" Grid.ColumnSpacing="0"
          WidthRequest="440" HorizontalOptions="Start"
          HeightRequest="400" VerticalOptions="Start"         
          Grid.RowSpan="3" Grid.Row="1">

      <Frame Padding="2,0,2,2" BackgroundColor="#f2f2f2">
        <ListView x:Name="LocationResultsListView"
                  BackgroundColor="#ffffff" RowHeight="60"
                  ItemsSource="{Binding LocationSearchItems}">
          <ListView.ItemTemplate>
            <DataTemplate>
              <ViewCell>
                <Grid>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="8" />
                  </Grid.RowDefinitions>
                  <StackLayout Orientation="Horizontal" Padding="20,10">
                    <Label FormattedText="{Binding LocationFormat, Converter={StaticResource searchCon}, ConverterParameter='lon'}" TextColor="#989898" />
                  </StackLayout>
                  <BoxView Grid.Row="1" Color="#f2f2f2" HeightRequest="4" VerticalOptions="Center" />
                </Grid>
              </ViewCell>
            </DataTemplate>
          </ListView.ItemTemplate>
        </ListView>
      </Frame>
    </Grid>

  </Grid>
</ContentPage>